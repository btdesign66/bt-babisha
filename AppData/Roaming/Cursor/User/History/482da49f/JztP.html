{% extends "base.html" %}

{% block title %}ALGO-WIZ - {{ algorithm_type.title() }} Visualization{% endblock %}

{% block content %}
<div class="visualization-page">
    <h1>{{ algorithm_type.title() }} Algorithm Visualization</h1>
    
    <div class="controls">
        <select id="algorithm-select" class="algorithm-dropdown">
            {% if algorithm_type == 'sorting' %}
                <option value="bubble">Bubble Sort</option>
                <option value="quick">Quick Sort</option>
                <option value="merge">Merge Sort</option>
                <option value="selection">Selection Sort</option>
                <option value="insertion">Insertion Sort</option>
                <option value="heap">Heap Sort</option>
            {% elif algorithm_type == 'searching' %}
                <option value="binary">Binary Search</option>
                <option value="linear">Linear Search</option>
            {% elif algorithm_type == 'linkedlist' %}
                <option value="insert">Insert Node</option>
                <option value="delete">Delete Node</option>
                <option value="reverse">Reverse List</option>
                <option value="detect_cycle">Detect Cycle</option>
                <option value="merge_sorted">Merge Sorted Lists</option>
            {% elif algorithm_type == 'pathfinding' %}
                <option value="dijkstra">Dijkstra's Algorithm</option>
                <option value="astar">A* Search</option>
            {% endif %}
        </select>

        {% if algorithm_type == 'searching' %}
        <div class="target-input-section">
            <h3>Enter Number to Search</h3>
            <div class="target-input-container">
                <input type="number" id="target-input" class="target-input" min="1" max="100" placeholder="Enter a number (1-100)">
                <button id="search-btn" class="search-btn">Search</button>
            </div>
        </div>
        {% endif %}

        {% if algorithm_type == 'linkedlist' %}
        <div class="linkedlist-controls">
            <div class="input-group">
                <label for="node-value">Node Value:</label>
                <input type="number" id="node-value" class="node-input" min="1" max="100" placeholder="Enter node value">
            </div>
            <div class="input-group">
                <label for="node-position">Position:</label>
                <input type="number" id="node-position" class="position-input" min="0" placeholder="Enter position (0 for start)">
            </div>
            <div class="operation-buttons">
                <button id="insert-btn" class="btn">Insert Node</button>
                <button id="delete-btn" class="btn">Delete Node</button>
                <button id="reverse-btn" class="btn">Reverse List</button>
                <button id="detect-cycle-btn" class="btn">Detect Cycle</button>
                <button id="merge-btn" class="btn">Merge Lists</button>
            </div>
        </div>
        {% endif %}

        <div class="input-section">
            <div class="input-group">
                <label for="user-input">Enter numbers (comma-separated):</label>
                <input type="text" id="user-input" placeholder="e.g., 5,2,8,1,9">
                <button id="validate-input">Validate Input</button>
            </div>
            <div id="input-feedback" class="feedback-message"></div>
            <div class="input-options">
                <button id="generate-btn">Generate Random Data</button>
                <input type="number" id="array-size" min="5" max="100" value="10" placeholder="Array size">
            </div>
        </div>
        
        <div class="execution-controls">
            <button id="start-btn" disabled>Start</button>
            <button id="pause-btn" disabled>Pause</button>
            <button id="step-btn" disabled>Step</button>
            <button id="reset-btn">Reset</button>
            <button id="theory-btn" class="btn-theory">Show Theory</button>
        </div>
        
        <div class="speed-control">
            <label for="speed">Animation Speed:</label>
            <input type="range" id="speed" min="1" max="5" value="3">
            <span id="speed-value">Normal</span>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="visualization-container">
            <div id="visualization"></div>
            <div id="explanation" class="explanation-panel">
                <h3>Algorithm Steps</h3>
                <div id="step-explanation"></div>
            </div>
            <div id="operation-history" class="operation-history-panel">
                <h3>Operation History</h3>
                <div class="history-container">
                    <div class="history-steps"></div>
                </div>
            </div>
        </div>

        <div class="theory-panel" id="theory-panel">
            <div class="theory-header">
                <h3>Theoretical Analysis</h3>
                <button class="close-theory">Ã—</button>
            </div>
            <div class="theory-content">
                <div class="theory-section">
                    <h4 id="algorithm-title">Algorithm Overview</h4>
                    <p id="algorithm-description"></p>
                </div>
                
                <div class="theory-section">
                    <h4>Time Complexity</h4>
                    <div class="complexity-grid">
                        <div class="complexity-item">
                            <span class="label">Best Case:</span>
                            <span id="time-best"></span>
                        </div>
                        <div class="complexity-item">
                            <span class="label">Average Case:</span>
                            <span id="time-average"></span>
                        </div>
                        <div class="complexity-item">
                            <span class="label">Worst Case:</span>
                            <span id="time-worst"></span>
                        </div>
                    </div>
                </div>
                
                <div class="theory-section">
                    <h4>Space Complexity</h4>
                    <p id="space-complexity-theory"></p>
                </div>
                
                <div class="theory-section">
                    <h4>Loop Invariant</h4>
                    <p id="loop-invariant"></p>
                </div>
                
                <div class="theory-section">
                    <h4>Correctness Proof</h4>
                    <ol id="proof-steps"></ol>
                </div>
                
                <div class="theory-section">
                    <h4>Current State</h4>
                    <div id="current-state">
                        <p id="current-invariant"></p>
                        <p id="progress-info"></p>
                    </div>
                </div>

                <div class="theory-section">
                    <h4>Complexity Analysis</h4>
                    <div class="complexity-grid">
                        <div class="complexity-item">
                            <span class="label">Best Case:</span>
                            <span id="time-best"></span>
                        </div>
                        <div class="complexity-item">
                            <span class="label">Average Case:</span>
                            <span id="time-average"></span>
                        </div>
                        <div class="complexity-item">
                            <span class="label">Worst Case:</span>
                            <span id="time-worst"></span>
                        </div>
                    </div>
                    <div id="growth-rate-graph" style="margin-top: 24px; height: 220px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-panel">
        <h3>Performance Statistics</h3>
        <div id="stats">
            <div class="stat-item">
                <label>Comparisons:</label>
                <span id="comparison-count">0</span>
            </div>
            <div class="stat-item">
                <label>Swaps:</label>
                <span id="swap-count">0</span>
            </div>
            <div class="stat-item">
                <label>Time Complexity:</label>
                <span id="time-complexity">-</span>
            </div>
            <div class="stat-item">
                <label>Space Complexity:</label>
                <span id="space-complexity">-</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_head %}
<style>
    /* Existing styles... */

    /* Linked List Specific Styles */
    .linkedlist-controls {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .node-input, .position-input {
        width: 120px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
    }

    .operation-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .operation-buttons button {
        background-color: #2196f3;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .operation-buttons button:hover {
        background-color: #1976d2;
    }

    /* Node visualization styles */
    .node {
        display: inline-flex;
        align-items: center;
        margin: 0 10px;
    }

    .node-value {
        background: #e3f2fd;
        border: 2px solid #90caf9;
        border-radius: 4px;
        padding: 10px 15px;
        font-weight: bold;
        color: #1976d2;
    }

    .node-pointer {
        width: 30px;
        height: 2px;
        background: #666;
        position: relative;
    }

    .node-pointer::after {
        content: '';
        position: absolute;
        right: 0;
        top: -4px;
        border-left: 8px solid #666;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
    }

    .node.highlighted .node-value {
        background: #fff8e1;
        border-color: #ffd740;
        color: #f57f17;
    }

    .node.selected .node-value {
        background: #ffebee;
        border-color: #ef5350;
        color: #d32f2f;
    }

    .node.visited .node-value {
        background: #e8f5e9;
        border-color: #66bb6a;
        color: #2e7d32;
    }
</style>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/d3.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/visualization.js') }}"></script>
{% if algorithm_type == 'sorting' %}
    <script src="{{ url_for('static', filename='js/sorting.js') }}"></script>
{% elif algorithm_type == 'searching' %}
    <script src="{{ url_for('static', filename='js/searching.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize searching visualization
            initSearching();
            
            // Add event listener for the search button
            document.getElementById('search-btn').addEventListener('click', function() {
                const targetInput = document.getElementById('target-input');
                const target = parseInt(targetInput.value);
                if (!isNaN(target)) {
                    state.target = target;
                    handleSearch();
                } else {
                    alert('Please enter a valid number to search');
                }
            });
            
            // Add event listener for target input change
            document.getElementById('target-input').addEventListener('change', function(event) {
                const target = parseInt(event.target.value);
                if (!isNaN(target)) {
                    state.target = target;
                }
            });
        });
    </script>
{% elif algorithm_type == 'linkedlist' %}
    <script src="{{ url_for('static', filename='js/linkedlist.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize linked list visualization
            initLinkedList();
        });
    </script>
{% elif algorithm_type == 'pathfinding' %}
    <script src="{{ url_for('static', filename='js/pathfinding.js') }}"></script>
{% endif %}
{% endblock %} 